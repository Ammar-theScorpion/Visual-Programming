{% load static %}
<!DOCTYPE html>
<html>
<head>
	<title>Tutorial</title>
      
  {% block mainscript %}
    
  {% endblock mainscript %}
	<style>
	body {
		font-family: sans-serif;
		margin: 0;
		padding: 0;
		display: flex;
		flex-direction: row;
		height: 100vh;
	}

	.left-section {
		background-color: #f5f5f5;
		flex: 0 0 300px;
		display: flex;
		flex-direction: column;
		padding: 20px;
	}

	.left-section h2 {
		font-size: 20px;
		margin: 0;
		margin-bottom: 20px;
	}

	.left-section .block {
		display: block;
		margin-bottom: 10px;
		padding: 10px;
		border: 1px solid #dcdcdc;
		border-radius: 5px;
		background-color: #fff;
		cursor: pointer;
		transition: background-color 0.2s ease;
	}

	.left-section .block:hover {
		background-color: #f0f0f0;
	}

	.right-section {
		flex: 1;
		display: flex;
		flex-direction: row;
		margin: 20px;
		border: 1px solid #dcdcdc;
		box-shadow: 0px 1px 5px #dcdcdc;
		border-radius: 5px;
		overflow: hidden;
	}

	.header {
		background-color: #393d4f;
		color: #fff;
		padding: 10px 20px;
	}

	.header h1 {
		font-size: 24px;
		margin: 0;
	}

	.problem-header {
		background-color: #f0f0f0;
		padding: 10px;
		display: flex;
		flex-direction: row;
		align-items: center;
		justify-content: space-between;
		border-bottom: 1px solid #dcdcdc;
	}

	.problem-header h2 {
		font-size: 20px;
		margin: 0;
	}

	.problem-info {
		padding: 10px;
		display: flex;
		flex-direction: row;
		align-items: center;
		border-bottom: 1px solid #dcdcdc;
	}

	.problem-info span {
		font-size: 14px;
		margin-right: 10px;
		color: #707070;
	}

	.problem-body {
		width: 50%;
		padding: 10px;
		line-height: 1.5;
		border-right: solid 6px #f0f0f0;
	}

	.workspace {
		flex: 2;
		display: flex;
		flex-direction: column;
		border-top: solid 6px #f0f0f0;
	}
	pre{
		tab-size: 4;
	}
	.code-column {
		flex: 1;
		display: flex;
		flex-direction: column;
		border-top: solid 6px #f0f0f0;
		border-right: solid 6px #f0f0f0;
	}

	.footer {
		background-color: #f0f0f0;
		padding: 10px 20px;
		display: flex;
		flex-direction: row;
		align-items: center;
		justify-content: flex-end;
	}


		.footer button {
			background-color: #393d4f;
			color: #fff;
			padding: 10px 20px;
			border: none;
			border-radius: 5px;
			font-size: 14px;
			cursor: pointer;
			margin: 2px;
		}

		.blocks-container{
			display: none;
		}
		.right-section {
  flex: 1;
  display: flex;
  flex-direction: row; /* changed from column */
  margin: 20px;
  border: 1px solid #dcdcdc;
  box-shadow: 0px 1px 5px #dcdcdc;
  border-radius: 5px;
  overflow: hidden;
}

.workspace {
  flex: 3;
  display: flex;
  flex-direction: column; /* changed from row */
  border-left: solid 6px #f0f0f0; /* changed from border-top */
  border-right: solid 6px #f0f0f0;
}

.problem-body {
  width: 50%; /* changed from 48.7% */
  padding: 10px;
  flex-grow: 1;
  line-height: 1.5;
  border-right: solid 6px #f0f0f0;
}
 
.codesspace{
	height: 65%;
	width: 100%;
	border-top: solid 6px #f0f0f0;

	bottom: 0;
}

	</style>
</head>
<body>
	<div class="left-section">
		<h2>Blocks</h2>
		<svg  style="overflow: visible;" xmlns="http://www.w3.org/2000/svg"
		xmlns:xlink="http://www.w3.org/1999/xlink"
		xmlns:html="http://www.w3.org/1999/xhtml"
		version="1.1" width="100%" height="100%">
			 
			{% block block %}
			{% endblock %}
		</svg>
  </div>
  <div class="right-section">
	<div class="problem-body">
		<div class="header">
			{{  tutorial.tname }}
		</div>
	  <div class="problem-header">
		<h2>Problem Description</h2>
		
	  </div>
	  <p>{{tutorial.body}}</p>
	  <div class="codesspace">
			<svg id="Am-workspace" xmlns="http://www.w3.org/2000/svg"
			xmlns:xlink="http://www.w3.org/1999/xlink"
			xmlns:html="http://www.w3.org/1999/xhtml"
			version="1.1" width="100%" height="100%">
	  </svg>
	  </div>

	</div>
		<div class="workspace">
			<div>
				<button onclick="lang_id = 0; language_type()">C++</button>
				<button onclick="lang_id = 1; language_type()">Python</button>
			</div>	
			
			<p id ='setcode' style="height: 100%;" >
				{{prev_code}}
			</p>
			<p id='error' style="height: 10%"> </p>
		<form method="post">
			{% csrf_token %}
			<input type="hidden" name="user_code" id="user_code_input"/>
			 <div class="footer">
				{% if step == 1 %}
				<button  type="submit" value="<-step"  ><- step </button>
					<button  type="submit" value="step->"  >step -> </button>
				{% else %}
					<button  type="submit" value="Submit"  >Run </button>
				{% endif %}
			</div>
		</form>
	</div>
	 
  
		<div id="flex" style="display: none; font: normal 11pt sans-serif;">
			<div id="inner" contenteditable="true" spellcheck="false"><div>
		</div>
  </body>

  <script>

	let language = '';
	let lang_id=0;
	var lang='C++';
	var code = '{{prev_code|safe}}';
	var step = '{{step|safe}}';
	const blocks = $('.draggable');
	let stepped = false

	function setBlock(){
		let space = 0;
		const blocks = $('.draggable');
		
		blocks.each(function(){
			$(this).attr('transform', 'translate('  + 0 + ',' + space + ')');
			space+=130;
		});
	}
		$('form button').click(function(event){
			console.log(event.target.innerHTML)
			if(event.target.innerHTML.indexOf('step')!==-1){
				stepped = true;
				window.translateAndSet()
			}
			event.preventDefault();
			const userCodeInput = document.getElementById('user_code_input');
			document.getElementById("setcode").innerHTML = language.split('`')[1];
			const text =  document.getElementById('setcode').innerHTML;
			console.log(text)
			userCodeInput.value = text.replace(/<br>/g, '\n').replace(/&nbsp;/g, ' ').replace(/&gt;/g, '>').replace(/&lt;/g, '<').replace(/&amp;/g, '&');
			var csrftoken = $("input[name='csrfmiddlewaretoken']").val();
			$.ajaxSetup({
				beforeSend: function(xhr, settings) {
					if (!/^(GET|HEAD|OPTIONS|TRACE)$/i.test(settings.type) && !this.crossDomain) {
						xhr.setRequestHeader('X-CSRFToken', csrftoken);
				}
			}
		});
		$.ajax({
			url: 'http://127.0.0.1:8000/test_code/',
				method:'POST',
				contentType: 'text/plain', // to prevent Django from treating the ajax as a form form the Query
				data: {
					'text':text,
					'tname':'44',
				},
				success: function(response){
					let inner =  document.querySelector('#error').innerHTML;
					if (inner=="undefined")
					document.querySelector('#error').innerHTML = response;
					else
					document.querySelector('#error').innerHTML+=response;
					if(response[response.length-1] == 't'){
						$('form button').html('Submit');
						$('form button').unbind('click');
					}
				}
			})
		});
		function language_type(){
			/*const button = event.target;
			lang = button.innerHTML;*/
			var code = language.split('`')[lang_id];
			var codeNode = document.createElement("pre");
			codeNode.style.whiteSpace = "pre-wrap";
			codeNode.textContent = code;
			document.getElementById("setcode").innerHTML = "";
			document.getElementById("setcode").appendChild(codeNode);
		}
		
		</script>
		<script type="module" type="text/javascript" src="{% static '/Am-logic/blocks.js' %}">
	</script>

</html>  
